{
  "version": 3,
  "sources": [
    "passport.js"
  ],
  "names": [
    "LocalStrategy",
    "require",
    "Strategy",
    "User",
    "module",
    "exports",
    "passport",
    "serializeUser",
    "user",
    "done",
    "id",
    "deserializeUser",
    "findById",
    "err",
    "use",
    "passReqToCallback",
    "req",
    "username",
    "password",
    "process",
    "nextTick",
    "findOne",
    "flash",
    "body",
    "firstName",
    "lastName",
    "city",
    "state",
    "country",
    "email",
    "newUser",
    "local",
    "generateHash",
    "toUpperCase",
    "books",
    "isbns",
    "requestsTo",
    "borrowingFrom",
    "save",
    "validPassword",
    "newPassword",
    "findOneAndUpdate",
    "new"
  ],
  "mappings": "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",
  "file": "passport.js",
  "sourceRoot": "../../src/config",
  "sourcesContent": [
    "var LocalStrategy = require('passport-local').Strategy\r\nvar User = require('../app/models/user')\r\n\r\nmodule.exports = function(passport) {\r\n  passport.serializeUser(function(user, done) {\r\n    done(null, user.id)\r\n  })\r\n  passport.deserializeUser(function(id, done) {\r\n    User.findById(id, function(err, user) {\r\n      done(err, user)\r\n    })\r\n  })\r\n\r\n  passport.use('local-signup', new LocalStrategy({ //must receive fields named as 'username' and 'password' in post data or else code is not executed\r\n    passReqToCallback : true\r\n  },\r\n  function(req, username, password, done) {\r\n    process.nextTick(function() {\r\n      User.findOne({ 'local.username' : username }, function(err, user) {\r\n        if (err) return done(err)\r\n        if (user) {\r\n          return done(null, false, req.flash('signupMessage', 'That username is already taken.'))\r\n        } else if (!req.body.firstName || !req.body.lastName || !req.body.city || !req.body.state || !req.body.country || !req.body.email) {\r\n          return done(null, false, req.flash('signupMessage', 'Form incomplete.'))\r\n        } else {\r\n          var newUser = new User()\r\n          newUser.local.username = username\r\n          newUser.local.password = newUser.generateHash(password)\r\n          newUser.local.firstName = req.body.firstName\r\n          newUser.local.lastName = req.body.lastName\r\n          newUser.local.city = req.body.city.toUpperCase()\r\n          newUser.local.state = req.body.state.toUpperCase()\r\n          newUser.local.country = req.body.country.toUpperCase()\r\n          newUser.local.email = req.body.email\r\n          newUser.local.books = []\r\n          newUser.local.isbns = []\r\n          newUser.local.requestsTo = []\r\n          newUser.local.borrowingFrom = []\r\n          newUser.save(function(err) {\r\n            if (err)\r\n              throw err\r\n            return done(null, newUser)\r\n          })\r\n        }\r\n      })\r\n    })\r\n  }))\r\n\r\n  passport.use('local-login', new LocalStrategy({\r\n    passReqToCallback : true\r\n  },\r\n  function(req, username, password, done) {\r\n    User.findOne({ 'local.username' : username }, { 'local.books': false, 'local.isbns': false }, function(err, user) {\r\n      if (err) return done(err)\r\n      if (!user) return done(null, false, req.flash('loginMessage', 'No user found.'))\r\n      if (!user.validPassword(password)) return done(null, false, req.flash('loginMessage', 'Oops! Wrong password.'))\r\n      return done(null, user)\r\n    })\r\n  }))\r\n\r\n  passport.use('password-update', new LocalStrategy({\r\n    passReqToCallback : true\r\n  },\r\n  function(req, username, password, done) {\r\n    if (!req.user.validPassword(password)) return done(null, false, req.flash('passwordMessage', 'Oops! Wrong password.'))\r\n    if (!req.body.newPassword) return done(null, false, req.flash('passwordMessage', 'new password field is blank.'))\r\n    var newPassword = req.user.generateHash(req.body.newPassword)\r\n    User.findOneAndUpdate({ 'local.username' : username }, { 'local.password' : newPassword }, { new : true }, function(err, user) {\r\n      if (err) return done(err)\r\n      return done(null, user)\r\n    })\r\n  }))\r\n\r\n  passport.use('details-update', new LocalStrategy({\r\n    passReqToCallback : true\r\n  },\r\n  function(req, username, password, done) {\r\n    if (!req.body.firstName || !req.body.lastName || !req.body.city || !req.body.state || !req.body.country || !req.body.email) {\r\n      return done(null, false, req.flash('settingsMessage', 'Form incomplete.'))\r\n    }\r\n    User.findOneAndUpdate({'local.username' : username },\r\n    {\r\n      'local.firstName' : req.body.firstName,\r\n      'local.lastName' : req.body.lastName,\r\n      'local.city' : req.body.city.toUpperCase(),\r\n      'local.state' : req.body.state.toUpperCase() ,\r\n      'local.country' : req.body.country.toUpperCase() ,\r\n      'local.email' : req.body.email\r\n    }, { new : true },\r\n    function(err, user) {\r\n      if (err) return done(err)\r\n      return done(null, user)\r\n    })\r\n  }))\r\n\r\n}\r\n"
  ]
}
